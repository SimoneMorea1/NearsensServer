@{
    ViewBag.Title = "PlaceDetail";
    var currentPlace = Model.place;
}
<br />

<form id="placeDetailForm">

    <p>Title</p>
    <input class="form-control" id="txtName" type="text" value="@currentPlace.Name" required />
    <p>Description</p>
    <textarea class="form-control" id="txtDescription" required>@currentPlace.Description</textarea>
    <p>Latitude</p>
    <input class="form-control" id="txtLat" type="number" value="@currentPlace.Lat.ToString().Replace(",", ".")" step="any" required />
    <p>Longitude</p>
    <input class="form-control" id="txtLng" type="number" value="@currentPlace.Lng.ToString().Replace(",", ".")" step="any" required />

    <p>Main category</p>
    <select id="slctCategory" class="form-control" required>
        @{
            if (currentPlace.MainCategory.Equals("AC"))
            {

                <option value="AC" selected>AC</option>
                <option value="POI">POI</option>
            }
            else
            {

                <option value="AC">Commercial activity</option>
                <option value="POI" selected>Point of interest</option>
            }


        }
    </select>

    <p>Subcategory</p>
    <select id="slctSubcategory" class="form-control" required>
        @{
            foreach (string subcategory in Model.subcategories)
            {
                if (@currentPlace.Subcategory.Equals(subcategory))
                {
                    <option value="@currentPlace.Subcategory" selected>@currentPlace.Subcategory</option>
                }
                else
                {
                    <option value="@subcategory">@subcategory</option>
                }
            }
        }
    </select>
    <br />
    <br />
    <p>Main photo</p>

    <img src="\@currentPlace.Icon" id="imgMainPhoto" style="width:300px">

    <br />
    <br />
    <div class="modal-body" style="display:none">

        <label class="label label-info col-lg-12" for="mainPhoto">Main photo</label>
        <br />
        <input type="file" id="mainPhoto" class="form-control col-lg-10" /> <input id="btnUploadMainPhoto" type="button" class="btn btn-success btn-sm col-lg-2" value="Upload" />
        <br style="clear:both" />

    </div>
    <input class="btn btn-group" id="btnDeleteMainPhoto" type="button" value="Delete Main photo" />

    <input class="btn btn-group" id="btnUpdatePlace" type="submit" value="Update" />
</form>
<div class="col-lg-4">
    <a href="@Url.Action("placePhotos/" + currentPlace.Id, "Home")">
        <button type="submit" style="margin-top:50%;width:200px;font-size:15px" class="btn btn-default"><span class="glyphicon glyphicon-camera" style="font-size:20px;"></span> MANAGE PHOTOS</button>
    </a>
</div>
@section scripts {
    <script type="text/javascript">

        $('#placeDetailForm').on('submit', function (e) {
            e.preventDefault();

            var place = {};
            place.Name = $('#txtName').val();
            place.Description = $('#txtDescription').val();
            place.MainCategory = $('#slctCategory').val();
            place.Subcategory = $('#slctSubcategory').val();
            place.Lat = parseFloat($('#txtLat').val());
            place.Lng = parseFloat($('#txtLng').val());
            place.Id = @currentPlace.Id;



            console.log(place);

            $.ajax({
                url: '/api/Places/',
                type: 'PUT',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(place),
                success: function (data) {
                    alert('Place updated');
                    location.reload();
                },
                error: function (error) {
                    alert('Error on Login' + error.statusCode);
                }
            });
        });


    var newPlaceId = @currentPlace.Id;

    $('#btnUploadMainPhoto').on('click', function () {

        var files = $("#mainPhoto").get(0).files;
        if (files.length > 0) {
            var mainPhoto = new FormData();
            mainPhoto.append("file0", files[0]);
            uploadMainPhoto(mainPhoto);
        }
    });


    $('#btnDeleteMainPhoto').on('click', function() {
        $('#imgMainPhoto').fadeOut();
        $('.modal-body').fadeIn();
    });

  


    function uploadMainPhoto(mainPhoto) {
        $.ajax({
            type: "POST",
            url: "/api/FileUpload/UploadPlaceIcon?placeId=" + newPlaceId,
            contentType: false,
            processData: false,
            data: mainPhoto,
            success: function (messages) {
                alert('Photo uploaded');
            },
            error: function (error) {
                alert("Upload failed");
            }
        });
    }


</script>

}

